<app-user-icon></app-user-icon>

<mat-card style="display: flex;">

  <!-- CHAT LIST -->
  <section class="chatList-section">
    <div
      style="display: flex; align-items: start; justify-content: start; flex-direction: column; background-color: rgb(0, 199, 43); padding-left: 20px; padding-right: 20px; padding-top: 10px; height: 10%;">
      <h5>Chats</h5>
      <input placeholder="Buscar chat" [(ngModel)]="searchTerm" (ngModelChange)="filterUsers()" style="margin-top: 5px; color: white; background: none; border-bottom:  2px solid white; 
        border-top: none; border-left: none;border-right: none; width: 100%;">
    </div>

    <div *ngFor="let user of filteredUsers" (click)="selectUser(user)">
      <div class="user-container">
        {{ user.nombre }}
        <span *ngIf="user.isTyping" style="font-size: x-small;">Escribiendo...</span>
      </div>
    </div>
  </section>

  <!-- OPEN CHAT -->
  <section class="chat-section" style="position: relative; width: 100%;">

    <div class="chat-contact-container">
      <span>{{profile?.nombre}} {{ selectedUser?.nombre }}</span>
      <span *ngIf="selectedUser?.isTyping">Escribiendo...</span>
      <span class="yo">{{me_user}}</span>
    </div>

    <div #messageContainer class="message-container">
      <div *ngFor="let message of messages" class="all-message">
        <div *ngIf="isFechaNueva(message)" class="fecha-nueva">
          <span >
            {{message.date | date: 'dd/MM/yyyy'}}
          </span>
        </div>
        <div 
          [ngClass]="{'sent-message': message.type === 'sent', 'received-message': message.type === 'received'}">
          {{ message.text }} <br/>
          <span class="message-date">{{ message.date | date: 'hh:mm a' }}</span>

        </div>
      </div>
    </div>

    <div class="message-input-container" style="position: absolute; bottom: 0; width: 100%;">
      <input class="message-input" placeholder="Escribe un mensaje" [(ngModel)]="newMessageText"
        (keyup.enter)="sendMessage()" (keyup)="checkIsTyping()">
      <button mat-icon-button class="sendButton">
        <mat-icon style="color: white; width: 3em; height: 3em; display: flex;
        align-items: center;
        justify-content: center;" (click)="sendMessage()">send</mat-icon>
      </button>
        <input type="file" (change)="handleFileInput($event)" accept=".txt,.pdf" id="actual-btn" style="display: none;"/> 
        <label for="actual-btn"  class="fileButton">
            <mat-icon style="color: white; display: flex; align-items: center; justify-content: center;">attach_file</mat-icon>
        </label>     
    </div>

  </section>

</mat-card>